
int creat_file()
{
	int ino;
	INODE *temp;
	MINODE *mtemp;
	time_t t;
	int i=1,dev; 
	char* cp,*tem,*parent,*child;
        char buf[BLKSIZE],tem[256];
	strcpy(tem, pathname);
	strcpy(parent, dirname(tem));   // dname="/a/b"

	strcpy(tem, pathname);
   	strcpy(child,basename(tem));   // bname="c"
		
	if(pathname[0]=='/')
	{
		dev=root->dev;
			
	}
	else
		dev=running->cwd->dev;
		
	printf("\nparent:%s\nchild:%s",parent,child);
		
	ino=getino(dev,parent);
printf("\ncreat happening");
	mtemp=iget(dev,ino);
	temp=&mtemp->INODE;
	/*i=check_list(parent,child);
	if(i)
		printf("\ncan create");		
	else 
		printf("\ncant create");		
*/printf("\ncreat happening");
	if((temp->i_mode&DIR_MODE==DIR_MODE)&&i)
		my_creat(mtemp,child,dev);
	printf("\ncreat happening");	
	
	temp->i_links_count++;
	temp->i_atime=ctime(&t);
	mtemp->dirty=1;
	iput(mtemp);
return 0;
} 


int my_creat(MINODE *mtemp, char *name,int dev)
{
int ino,bno,i;
MINODE *temp;
INODE *itemp;

char buf[BLKSIZE];
	
	ino = ialloc(dev);    
        bno = balloc(dev);
		printf("\nino1:%d",ino);

		printf("\nbno1:%d",bno);
	if(!ino)
		printf("ino not allocated");
	
	if(!bno)
		printf("bno not allocated");	
	temp = iget(dev, ino);
	itemp=&temp->INODE;

	itemp->i_mode=0X81A4;
	itemp->i_uid  = running->uid;	// Owner uid 
  	itemp->i_gid  = running->gid;	// Group Id
  	itemp->i_size = 0;		// Size in bytes 
  	itemp->i_links_count = 1;	        // Links count=2 because of . and ..
  	itemp->i_atime =time(0L);
	itemp->i_ctime = time(0L);
	itemp->i_mtime = time(0L);  // set to current time
  	itemp->i_blocks = 2;                	// LINUX: Blocks count in 512-byte chunks 
  	for(i=1;i<15;i++)
		itemp->i_block[i] =0; 	
	itemp->i_block[0] = bno;             // new DIR has one data block   
	
  	temp->dirty = 1;               // mark minode dirty
	
	iput(temp);
	
//	printf("\nmy mkdir1");
	DIR *dp=(DIR*)buf;
	dp->inode=ino;
	dp->rec_len=12;	
	dp->name_len=1;
	dp->file_type=0;
	strcpy(dp->name,".");
//	printf("\nmy mkdir2");	
	
	dp=(DIR*)((int)dp+dp->rec_len);
	dp->inode=mtemp->ino;
	dp->rec_len=1012;
	dp->name_len=2;
	dp->file_type=0;
	strcpy(dp->name,"..");

//	printf("\nmy mkdir4");

	put_block(dev,bno,buf);
//	printf("\nmy mkdir5");
	
        enter_name(mtemp, ino, name);
return 0;
}  

